<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Parallel Coordinates</title>
</head>
<body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var dataset = [
    {"x": 0, "a": 50, "b": 23, "y": 50, "z": 50, },
    {"x": 1, "a": 23, "b": 43, "y": 43, "z": 23, },
    {"x": 2, "a": 81, "b": 18, "y": 81, "z": 81, },
    {"x": 3, "a": 19, "b": 19, "y": 19, "z": 19, },
    {"x": 4, "a": 52, "b": 32, "y": 52, "z": 52, },
    {"x": 5, "a": 34, "b": 44, "y": 24, "z": 34, },
    {"x": 6, "a": 87, "b": 17, "y": 87, "z": 87, },
    {"x": 7, "a": 17, "b": 47, "y": 17, "z": 17, },
    {"x": 8, "a": 98, "b": 78, "y": 68, "z": 98, },
    {"x": 9, "a": 49, "b": 29, "y": 49, "z": 49, },
    {"x": 0, "a": 10, "b": 20, "y": 30, "z": 10, },
    {"x": 1, "a": 53, "b": 33, "y": 43, "z": 53, },
    {"x": 2, "a": 81, "b": 41, "y": 81, "z": 81, },
    {"x": 3, "a": 19, "b": 69, "y": 19, "z": 19, },
    {"x": 4, "a": 12, "b": 32, "y": 52, "z": 12, },
    {"x": 5, "a": 24, "b": 34, "y": 24, "z": 24, },
    {"x": 6, "a": 17, "b": 27, "y": 87, "z": 17, },
    {"x": 7, "a": 17, "b": 47, "y": 17, "z": 17, },
    {"x": 8, "a": 68, "b": 63, "y": 68, "z": 68, },
    {"x": 9, "a": 49, "b": 42, "y": 49, "z": 49, },
    {"x": 9, "a": 49, "b": 29, "y": 49, "z": 49, },
  ];

    var color = d3.scaleOrdinal(d3.schemeCategory20c);

    var margin = {top: 50, right: 20, bottom: 30, left: 40},
        width = 700 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var svg = d3.select('body')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom )
              .append('g')
                .attr('transform', `translate(${margin.left}, ${margin.top})`);
    var y = {}
    var x = d3.scalePoint()
                .domain(dimensions = d3.keys(dataset[0])
                        .filter(function(d) {
                            return d != 'name' &&
                            ( y[d] = d3.scaleLinear()
                                .domain(d3.extent(dataset, function(p) {
                                    // console.log(p,d);
                                    return +p[d]; }))
                                .range([height, 0])); }))
                .range([0,width]);

    var line = d3.line();
    var axis = d3.axisLeft();

    var background = svg.append('g')
        .attr('class', 'line').selectAll('path')
        .data(dataset)
        .enter().append('path')
        .attr('d', function(d) {
            // console.log(d);
            return line(dimensions.map(function(p) {
                return [x(p), y[p](d[p])]; }));
        })
        .style('fill','none')
        .style('stroke-width', 1)
        // .style('stroke', 'rgba(40, 131, 198, 0.65)');
        .style('stroke', 'rgba(75, 75, 75, 0.63)');

    var foreground = svg.append('g')
        .attr('class', 'line').selectAll('path')
        .data(dataset)
        .enter().append('path')
        .attr('d', function(d) {
            return line(dimensions.map(function(p) {
                return [x(p), y[p](d[p])]; }));
        })
        .style('fill','none')
        .style('stroke-width', 1)
        // .style('stroke', 'rgba(40, 131, 198, 0.65)');
        .style('stroke', function(d, i) { return color(i); });

    var g = svg.selectAll('.dimension')
                .data(dimensions)
                .enter().append('g')
                .attr('class','dimension')
                .attr('transform', function(d){ return `translate(${x(d)})`; });

    g.append('g')
        .attr('class', 'axis')
        .each(function(d) {
            // console.log(y[d]);
            d3.select(this).call(axis.scale(y[d]));
        })
        .append('text')
        .style('text-anchor', 'middle')
        .attr('y', -9)
        .attr('fill', 'black')
        .text(function(d) { return d; });

    var brush = d3.brushY().extent([[-12, 0], [12, height]])
                            .on('brush', brushed)
                            .on('end', brushEnded);

    g.append('g')
        .attr('class', 'brush')
        .each(function(d) {
            // console.log(d);
            d3.select(this).call(brush);
        });


    var conditions = {};
    function brushed(d) {
        conditions[d] = d3.event.selection.map(y[d].invert);
        // console.log(conditions[d][0], conditions[d][1]);
        hide();
    }
    function brushEnded(d) {
        if(d3.event.selection === null) {
            delete conditions[d];
            hide();
        }
    }
    function hide() {
        foreground.style('display', function(d) {
            for(var k in conditions) {
                if(d[k]>=conditions[k][0] || d[k]<=conditions[k][1]) {
                    return 'none';
                }
            }
        });
    }


</script>
</body>
</html>
